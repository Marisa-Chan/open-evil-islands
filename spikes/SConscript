#!/usr/bin/env python
# -*- coding: utf-8 -*-

#  This file is part of Cursed Earth.
#
#  Cursed Earth is an open source, cross-platform port of Evil Islands.
#  Copyright (C) 2009-2010 Yanis Kurganov.
#
#  This program is free software: you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation, either version 3 of the License, or
#  (at your option) any later version.
#
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
#  GNU General Public License for more details.
#
#  You should have received a copy of the GNU General Public License
#  along with this program. If not, see <http://www.gnu.org/licenses/>.

import os

import SCons.Util

Import("env")
env = env.Clone()

env.AppendUnique(
	CPPPATH=[os.path.join("#game", "include")],
	LIBPATH=[os.path.join("#game", "lib", "$GEN_PATH")],
	LIBS=["game"],
)

if env["OS"] == "posix":
	env.AppendUnique(
		LIBS=["glut"],
	)
elif env["OS"] == "win32":
	env.AppendUnique(
		LIBS=["freeglut", "glu32",
				"opengl32", "winmm", "gdi32"],
	)

def make_target(name):
	env.VariantDir(os.path.join(name, "build", "$GEN_PATH"),
		os.path.join(name, "src"), duplicate=False)
	return env.Alias(name, env.Command(os.path.join(name, "bin",
		SCons.Util.adjustixes(name, env.subst("$PROGPREFIX"),
		env.subst("$PROGSUFFIX"))), env.Program(os.path.join(name, "bin",
		"$GEN_PATH", name), [os.path.join(name, "build", "$GEN_PATH",
		node.name) for node in env.Glob(os.path.join(name, "src", "*.c"))]),
		Copy("$TARGET", "$SOURCE")))

targets = [make_target(name) for name in os.listdir(".") if os.path.isdir(name)]

Return("targets")
