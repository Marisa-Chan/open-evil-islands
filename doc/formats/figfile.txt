Cursed Earth FIG file format
==============================

   * This file is part of Cursed Earth.

     Cursed Earth is an open source, cross-platform port of Evil Islands.
     Copyright (C) 2009-2010 Yanis Kurganov.

     Permission is granted to copy, distribute and/or modify this document
     under the terms of the GNU Free Documentation License, Version 1.3
     or any later version published by the Free Software Foundation;
     with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.

     You should have received a copy of the GNU Free Documentation License
     along with this program. If not, see <http://www.gnu.org/licenses/>.

   * This is an internal documentation currently available only on Russian.
     Something more strong in English will be later.

   * Введение.
     Формат fig представляет из себя полное описание меша модели -
     набора вершин, определяющих её форму. Помимо этого, в fig присутствуют
     данные нормалей и текстурных координат.

   * Описание.
     Заголовок:
     uint32 signature - сигнатура, определяющая тип формата (fig1, fig6, fig8)
     uint32 vertex count - количество вершин
     uint32 normal count - количество нормалей
     uint32 texcoord count - количество текстурных координат
     uint32 index count - количество индексов
     uint32 vertex component count - количество компонентов для вершины
     uint32 morph component count - количество компонентов для морфинга
     uint32 unknown - неизвестно; возможно, для выравнивания; всегда 0
     uint32 unknown2 - неизвестно!
     uint32 texture number - номер текстуры

     В зависимости от типа формата выбирается число n - назовём его
     количеством вариантов. Дело в том, что значения записаны в fig не
     "как есть", а блоками размером n. С учётом конкретной комплекции из
     одного блока рассчитывается одно значение (скаляр). Из 3-х блоков
     получается вектор. Фактически сие есть улучшенный вариант масштабирования.
     При обычном масштабировании нам доступно изменение размеров объекта по
     3-м измерениям. При варианте с комплекцией у нас развязываются руки и
     мы можем, например, открывать крышку сундука...

     Номер тестуры означает первичная это текстура или вторичная.
     Речь идёт не о наложении текстур (мультитекстурировании), а о выборе
     текстуры из списка (составленного, например, из mob файла).
     Внимание! До конца не ясно, что ещё это означает, т.к. для некоторых
     объектов значения могут быть > 2 (например, 8).

     Данные об ограничивающих объектах:
     float center (xyz * n) - центр модели, вектор
     float min (xyz * n) - минимальная координата модели, вектор
     float max (xyz * n) - максимальная координата модели, вектор
     float radius (n) - радиус модели, скаляр

     Здесь всё понятно. По этим данным можно построить любой
     ограничивающий объект.

     Данные модели:
     float vertices (4 * xyz * n) - вершины
     float normals (4 * xyzw) - нормали
     float texcoords (xy) - текстурные координаты
     uint16 indices - индексы
     vertex components - компоненты для вершины
        vertex index - индекс вершины
        normal index - индекс нормали
        texcoord index - индекс тукстурной координаты
     morph components - компоненты для морфинга
        morph index - индекс вектора-смещения для морфинга (см. anmfile)
        vertex index - индекс вершины

     Вершины.
     Каждая вершина в fig содержит 4 блока для каждой компоненты x, y и z.
     Т.е. из неё можно извлечь 4 "нормальные" вершины по комплекции.
     Внимание! В рамках одной вершины блоки для каждого компонента
     располагаются непрерывно, т.е. сначала 4 блока для x, потом 4 для y и т.д.

     Нормали.
     Каждая нормаль в fig содержит 4 компоненты x, y, z и w.
     Т.е. из неё можно получить 4 "нормальные" нормали напрямую.
     Внимание! Блоки располагаются так же, как и у вершин, см. выше.

     Текстурные координаты.
     Ничего необычного - пара xy (uv). Только одно замечание: значения
     могут выходить за границы отрезка [0,1], что значит возможность
     повторения текстуры.

     Индексы.
     Индекс - это индекс :) компонента для вершины, см. ниже. Количество
     всегда кратно 3-м, что означает серию несвязанных треугольников.

     Компоненты для вершины.
     Тройка чисел, полностью определяющая одну вершину треугольника:
     индексы вершины, нормали и текстурной координаты.

     Компоненты для морфинга.
     Фактически это карта, отображающая вектор-смещение из anmfile на
     вершину из figfile. Эта карта нужна, т.к. смещений морфинга может
     быть меньше, чем вершин. См. пример.

   * Пример.
     Модель: unmoco2 (столб с кнопками главного меню).
     Часть: but01 (метка для кпонки "новая игра").
     Местонахождение: menus.res -> unmoco2.mod -> but01.

     signature: 0x38474946
     vertex count: 2
     normal count: 2
     texcoord count: 4
     index count: 12
     vertex component count: 8
     morph component count: 8
     unknown: 0
     unknown2: 18
     texture number: 2

     Center:
     -0.000557 0.000537 -0.034701
     -0.000557 0.000537 -0.034701
     -0.000557 0.000537 -0.034701
     -0.000557 0.000537 -0.034701
     -0.000557 0.000537 -0.034701
     -0.000557 0.000537 -0.034701
     -0.000557 0.000537 -0.034701
     -0.000557 0.000537 -0.034701

     Min:
     -0.492459 -0.035761 -0.101966
     -0.492459 -0.035761 -0.101966
     -0.492459 -0.035761 -0.101966
     -0.492459 -0.035761 -0.101966
     ...

     Max:
     0.492459 0.035761 0.101966
     0.492459 0.035761 0.101966
     0.492459 0.035761 0.101966
     0.492459 0.035761 0.101966
     ...

     Radius:
     0.504175 0.504175 0.504175 0.504175
     0.504175 0.504175 0.504175 0.504175

     Vertices:
     -0.493017 -0.035224 0.067265
     ...

     Normals
     0.000000 -1.000000 0.000000 1.000000
     ...

     Texcoords:
     0.017222 0.845068
     0.681266 0.845068
     0.681266 0.982561
     0.017222 0.982562

     Indices:
     0 1 2 2 3 0 4 5 6 6 7 4

     Vertex components:
     0 0 0
     1 1 1
     2 2 2
     3 3 3
     4 4 1
     5 5 0
     6 6 3
     7 7 2

     Morph components:
     0 0
     1 1
     2 2
     3 3
     4 4
     5 5
     6 6
     7 7

     Модель: unmosu (гарпия).
     Часть: r_pereponka (перепонка).
     Местонахождение: figures.res -> unmosu.mod -> r_pereponka.

     Morph components:
     ...
     19 19
     20 20
     20 21
     20 22
     20 23

     Пояснение.
     Количество вершин в перепонке - 24. Количество смещений морфинга - 21.
     Карта выше применяет последнее смещение ещё дополнительно к 3-м вершинам.
